<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>markdown2hugo.py - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    
<div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
    <li><a href="../README_md.html">README</a>
    <li><a href="../config_toml.html">config.toml</a>
    <li><a href="../deploy_sh.html">deploy.sh</a>
    <li><a href="../fasademesteren/archetypes/default_md.html">default</a>
    <li><a href="../fasademesteren/config_toml.html">config.toml</a>
    <li><a href="../fasademesteren/content/README_md.html">README</a>
    <li><a href="../fasademesteren/content/_index_md.html">_index</a>
    <li><a href="../fasademesteren/content/kontakt/kontakt_md.html">kontakt</a>
    <li><a href="../fasademesteren/content/kontakt/kontaktinfo_md.html">kontaktinfo</a>
    <li><a href="../fasademesteren/content/kunder/kunderef_md.html">kunderef</a>
    <li><a href="../fasademesteren/content/public/categories/index_xml.html">index.xml</a>
    <li><a href="../fasademesteren/content/public/index_xml.html">index.xml</a>
    <li><a href="../fasademesteren/content/public/sitemap_xml.html">sitemap.xml</a>
    <li><a href="../fasademesteren/content/public/tags/index_xml.html">index.xml</a>
    <li><a href="../fasademesteren/content/themes/fasademesteren/LICENSE.html">LICENSE</a>
    <li><a href="../fasademesteren/content/themes/fasademesteren/archetypes/default_md.html">default</a>
    <li><a href="../fasademesteren/content/themes/fasademesteren/layouts/404_html.html">404.html</a>
    <li><a href="../fasademesteren/content/themes/fasademesteren/layouts/_default/baseof_html.html">baseof.html</a>
    <li><a href="../fasademesteren/content/themes/fasademesteren/layouts/_default/list_html.html">list.html</a>
    <li><a href="../fasademesteren/content/themes/fasademesteren/layouts/_default/single_html.html">single.html</a>
    <li><a href="../fasademesteren/content/themes/fasademesteren/layouts/index_html.html">index.html</a>
    <li><a href="../fasademesteren/content/themes/fasademesteren/layouts/partials/footer_html.html">footer.html</a>
    <li><a href="../fasademesteren/content/themes/fasademesteren/layouts/partials/head_html.html">head.html</a>
    <li><a href="../fasademesteren/content/themes/fasademesteren/layouts/partials/header_html.html">header.html</a>
    <li><a href="../fasademesteren/content/themes/fasademesteren/theme_toml.html">theme.toml</a>
    <li><a href="../fasademesteren/content/tjenester/betongreno_md.html">betongreno</a>
    <li><a href="../fasademesteren/content/tjenester/fasade_md.html">fasade</a>
    <li><a href="../fasademesteren/content/tjenester/malinginne_md.html">malinginne</a>
    <li><a href="../fasademesteren/content/tjenester/malingute_md.html">malingute</a>
    <li><a href="../fasademesteren/content/tjenester/vaskmose_md.html">vaskmose</a>
    <li><a href="../fasademesteren/content/txt/intro_txt.html">intro</a>
    <li><a href="../fasademesteren/content/txt/kunderef_txt.html">kunderef</a>
    <li><a href="../fasademesteren/content/txt/main_txt.html">main</a>
    <li><a href="../fasademesteren/deploy_sh.html">deploy.sh</a>
    <li><a href="../fasademesteren/markdown2hugo_py.html">markdown2hugo.py</a>
    <li><a href="../fasademesteren/public/categories/index_xml.html">index.xml</a>
    <li><a href="../fasademesteren/public/index_xml.html">index.xml</a>
    <li><a href="../fasademesteren/public/kontakt/index_xml.html">index.xml</a>
    <li><a href="../fasademesteren/public/kunder/index_xml.html">index.xml</a>
    <li><a href="../fasademesteren/public/sitemap_xml.html">sitemap.xml</a>
    <li><a href="../fasademesteren/public/tags/index_xml.html">index.xml</a>
    <li><a href="../fasademesteren/public/themes/fasademesteren/LICENSE.html">LICENSE</a>
    <li><a href="../fasademesteren/public/themes/fasademesteren/layouts/404_html.html">404.html</a>
    <li><a href="../fasademesteren/public/themes/fasademesteren/layouts/_default/baseof_html.html">baseof.html</a>
    <li><a href="../fasademesteren/public/themes/fasademesteren/layouts/_default/list_html.html">list.html</a>
    <li><a href="../fasademesteren/public/themes/fasademesteren/layouts/_default/single_html.html">single.html</a>
    <li><a href="../fasademesteren/public/themes/fasademesteren/layouts/index_html.html">index.html</a>
    <li><a href="../fasademesteren/public/themes/fasademesteren/layouts/partials/footer_html.html">footer.html</a>
    <li><a href="../fasademesteren/public/themes/fasademesteren/layouts/partials/head_html.html">head.html</a>
    <li><a href="../fasademesteren/public/themes/fasademesteren/layouts/partials/header_html.html">header.html</a>
    <li><a href="../fasademesteren/public/themes/fasademesteren/theme_toml.html">theme.toml</a>
    <li><a href="../fasademesteren/public/themes/index_xml.html">index.xml</a>
    <li><a href="../fasademesteren/public/tjenester/index_xml.html">index.xml</a>
    <li><a href="../fasademesteren/public/txt/intro_txt.html">intro</a>
    <li><a href="../fasademesteren/public/txt/kunderef_txt.html">kunderef</a>
    <li><a href="../fasademesteren/public/txt/main_txt.html">main</a>
    <li><a href="../fasademesteren/themes/fasademesteren/LICENSE.html">LICENSE</a>
    <li><a href="../fasademesteren/themes/fasademesteren/archetypes/default_md.html">default</a>
    <li><a href="../fasademesteren/themes/fasademesteren/layouts/404_html.html">404.html</a>
    <li><a href="../fasademesteren/themes/fasademesteren/layouts/_default/baseof_html.html">baseof.html</a>
    <li><a href="../fasademesteren/themes/fasademesteren/layouts/_default/list_html.html">list.html</a>
    <li><a href="../fasademesteren/themes/fasademesteren/layouts/_default/single_html.html">single.html</a>
    <li><a href="../fasademesteren/themes/fasademesteren/layouts/index_html.html">index.html</a>
    <li><a href="../fasademesteren/themes/fasademesteren/layouts/partials/footer_html.html">footer.html</a>
    <li><a href="../fasademesteren/themes/fasademesteren/layouts/partials/head_html.html">head.html</a>
    <li><a href="../fasademesteren/themes/fasademesteren/layouts/partials/header_html.html">header.html</a>
    <li><a href="../fasademesteren/themes/fasademesteren/theme_toml.html">theme.toml</a>
    <li><a href="../kontakt/kontakt_md.html">kontakt</a>
    <li><a href="../kontakt/kontaktinfo_md.html">kontaktinfo</a>
    <li><a href="../kunder/kunderef_md.html">kunderef</a>
    <li><a href="../markdown2hugo_py.html">markdown2hugo.py</a>
    <li><a href="../public/categories/index_xml.html">index.xml</a>
    <li><a href="../public/index_xml.html">index.xml</a>
    <li><a href="../public/sitemap_xml.html">sitemap.xml</a>
    <li><a href="../public/tags/index_xml.html">index.xml</a>
    <li><a href="../themes/fasademesteren/LICENSE.html">LICENSE</a>
    <li><a href="../themes/fasademesteren/archetypes/default_md.html">default</a>
    <li><a href="../themes/fasademesteren/layouts/404_html.html">404.html</a>
    <li><a href="../themes/fasademesteren/layouts/_default/baseof_html.html">baseof.html</a>
    <li><a href="../themes/fasademesteren/layouts/_default/list_html.html">list.html</a>
    <li><a href="../themes/fasademesteren/layouts/_default/single_html.html">single.html</a>
    <li><a href="../themes/fasademesteren/layouts/index_html.html">index.html</a>
    <li><a href="../themes/fasademesteren/layouts/partials/footer_html.html">footer.html</a>
    <li><a href="../themes/fasademesteren/layouts/partials/head_html.html">head.html</a>
    <li><a href="../themes/fasademesteren/layouts/partials/header_html.html">header.html</a>
    <li><a href="../themes/fasademesteren/theme_toml.html">theme.toml</a>
    <li><a href="../tjenester/betongreno_md.html">betongreno</a>
    <li><a href="../tjenester/fasade_md.html">fasade</a>
    <li><a href="../tjenester/malinginne_md.html">malinginne</a>
    <li><a href="../tjenester/malingute_md.html">malingute</a>
    <li><a href="../tjenester/vaskmose_md.html">vaskmose</a>
    <li><a href="../txt/intro_txt.html">intro</a>
    <li><a href="../txt/kunderef_txt.html">kunderef</a>
    <li><a href="../txt/main_txt.html">main</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page fasademesteren/markdown2hugo.py">

<p>import argparse import os import logging import re import shutil</p>

<p>def note_files(path):</p>

<pre>for root, dirs, files in os.walk(path):
    for file in files:
        if file.endswith(&quot;.md&quot;):
            yield (
                os.path.join(root, file),                                       # get md file
                [os.path.join(root, d) for d in dirs if d.endswith(&#39;.assets&#39;)]  # get corresponfing assets directories
            )</pre>

<p>def parse_header(mdtext):</p>

<pre>yaml_beg = mdtext.find(&#39;---&#39;) # should be 0
yaml_end = mdtext.find(&#39;---&#39;, yaml_beg + 1)
title = &quot;# title&quot;
match = re.search(r&#39;# (.*)&#39;, mdtext)

if match is None:
    raise Exception(&quot;Can&#39;t find the title!&quot;)
else:
    title = match.group(1)

return mdtext[:yaml_end] + f&#39;title: &quot;{title}&quot;\n&#39; + mdtext[yaml_end:]</pre>

<p>def replace_directories(mdtext, dirs, dst):</p>

<pre class="ruby"><span class="ruby-identifier">target</span> = <span class="ruby-string">&quot;/img/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dirs</span>
<span class="ruby-keyword">return</span> <span class="ruby-identifier">mdtext</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">dirs</span>, <span class="ruby-identifier">target</span>).<span class="ruby-identifier">replace</span>(<span class="ruby-string">&quot;./&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dirs</span>, <span class="ruby-identifier">target</span>)
</pre>

<p>def convert(in_dir, out_notes, out_assets):</p>

<pre>for note, assets in note_files(in_dir):
    mdtext = None
    with open(note, &#39;r&#39;) as f:
        mdtext = f.read()

    try:
        # parse header and assets
        mdtext = parse_header(mdtext)
        asset = None

        if len(assets) &gt; 0:
            asset = assets[0]
            dir_basename = os.path.basename(asset)
            dst_assets = os.path.join(out_assets, dir_basename)
            mdtext = replace_directories(mdtext, dir_basename, dst_assets)

        # save
        note_original_dir = os.path.dirname(note)
        note_relative_dir = note_original_dir.replace(in_dir, &quot;&quot;)[1:] # remove leading slash
        note_output_dir = os.path.join(out_notes, note_relative_dir)
        if not os.path.exists(note_output_dir):
            logging.info(f&quot;Destination directory didn&#39;t exist, creating it: {note_output_dir}&quot;)
            os.makedirs(note_output_dir)

        with open(os.path.join(note_output_dir, os.path.basename(note)), &#39;w&#39;) as f:
            f.write(mdtext)

        if asset != None:
            if os.path.exists(dst_assets):
                shutil.rmtree(dst_assets)
            shutil.copytree(asset, dst_assets)

    except Exception as e:
        logging.error(&quot;Exception: &quot;, e)
        return</pre>

<p>def main():</p>

<pre>parser = argparse.ArgumentParser(description=&quot;Script for converting md notes into hugo-compatibile pages&quot;)

parser.add_argument(&#39;in_dir&#39;, type=str,help=&quot;Path to root notes directory&quot;)
parser.add_argument(&#39;out_notes&#39;, type=str, help=&quot;Output directory for md notes&quot;)
parser.add_argument(&#39;out_assets&#39;, type=str, help=&quot;Output directory for assets (i.e local images)&quot;)
parser.add_argument(&#39;-v&#39;, dest=&#39;verbose&#39;, action=&quot;store_true&quot;, help=&quot;Enable debug logging&quot;, default=False)

args = parser.parse_args()

# change loglever
loglevel = logging.ERROR
if args.verbose:
    loglevel = logging.DEBUG
logging.basicConfig(level=loglevel)

# check existance of directories
if not os.path.exists(args.in_dir):
    logging.error(&quot;Can&#39;t find input directory!&quot;)
    return

for d in [args.out_notes, args.out_assets]:
    if not os.path.exists(d):
        logging.info(f&quot;Create not existed directory: {d}&quot;)
        os.makedirs(d)

# run code
convert(args.in_dir, args.out_notes, args.out_assets)</pre>

<p>if __name__ == “__main__”:</p>

<pre class="ruby"><span class="ruby-identifier">main</span>()
</pre>

</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.3.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

